name: publish_to_npm
runs:
  using: composite
  steps:
  - name: Publish to NPM
    env: 
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
    run: |-
      # Add NPM token to allow publishing
      echo "//registry.npmjs.org/:_authToken=$NODE_AUTH_TOKEN" > ~/.npmrc

      if [[ $RELEASE ]]; then
        # Publish all changed packages. The "from-package" arg means "look
        # at the version numbers in each package.json file and if that doesn't
        # exist on NPM, publish"
        npm run lerna -- publish from-package --yes --no-verify-access --dry-run
      fi

      # Cleanup
      rm ~/.npmrc